<!DOCTYPE html>
<html lang="en">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <meta name="generator" content="AsciiDoc 8.6.9">
      <title>HCI/CprE/ComS 575: Homework #2</title>
      <link rel="stylesheet" href="./riak.css" type="text/css">
   </head>
   <body class="article">
      <div id="header">
         <h1>HCI/CprE/ComS 575: Homework #2</h1>
         <!-- MAKE CHANGES HERE: Student information -->
         <span id="author">Your Name</span><br>
         <span id="email" class="monospaced">&lt;
         <a href="mailto:Your Email">Your Email</a>&gt;</span><br>
         <!-- END CHANGES -->
      </div>
      <div id="content">
        <p>Supplementary files for this homework are posted on <a href="../../">the
        class web page</a>.</p>
         <div class="sect1">
            <h2 id="_part_1a">Part 1A</h2>
            <div class="sectionbody">
               <div class="paragraph">
                 <p>Write two programs, one with Matlab <strong>and</strong>
                 another with OpenCV, that identify <strong>each</strong> of the 64 squares on the
                 chess board and labels them with &apos;a1&apos;, &apos;b1&apos;,
                 &apos;a2&apos;, ..., &apos;g8&apos; and &apos;h8&apos;.
                 In each label, the letter indicates the column and the
                 digit indicates the row, starting from the bottom left corner.
                 Your programs should place one label in each of the 64 squares.
                 See this Wikipedia <a
                 href="https://en.wikipedia.org/wiki/Chess">page</a> for more
                 information about this labeling system.
                  </p>
               </div>
               <div class="sect2">
                  <h3 id="_matlab">Matlab</h3>
                  <table class="tableblock frame-all grid-all" style=" width:100%; ">
                     <col style="width:50%;">
                     <col style="width:50%;">
                     <tbody>
                        <tr>
                           <td class="tableblock halign-left valign-top" >
                              <p class="tableblock"><span class="image">
                                 <img src="input/Part_1/p1_board.jpg" alt="input/Part_1/p1_board.jpg" width="100%">
                                 </span>
                              </p>
                           </td>
                           <td class="tableblock halign-left valign-top" >
                              <p class="tableblock">
                                 <span class="image">
                                    <!-- MAKE CHANGES HERE: Part 1 MATLAB Handle -->
                                    <img src="output/Part_1a/p1a_matlab_result.png" alt="Handle" width="100%">
                                    <!-- END CHANGES -->
                                 </span>
                              </p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
                  <div class="listingblock">
                     <div class="title">Source</div>
                     <div class="content monospaced">
                        <!-- MAKE CHANGES HERE: Part 1 MATLAB code -->
                        <pre>
                           % Read image
                           src = imread('C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_1\\p1_board.jpg');
                           dst = src;
                           
                           % Pad the side of the image with 255 pixels for grid detection
                           src(1,:) = 100;
                           src(end,:) = 100;
                           src(:,1) = 100;
                           src(:,end) = 100;
                           
                           % Detect the corner points and use those for grid box labels
                           corners = corner(src);
                           
                           % Round each corner to the nearest multiple of 60 (grid square size)
                           for i = 1:size(corners,1)
                               if mod(corners(i,1),60)>5
                                   corners(i,1) = 60*ceil(corners(i,1)/60);
                               elseif mod(corners(i,1),60)>0
                                   corners(i,1) = 60*floor(corners(i,1)/60);
                               end
                           end
                           
                           for i = 1:size(corners,1)
                               if mod(corners(i,2),60)>5
                                   corners(i,2) = 60*ceil(corners(i,2)/60);
                               elseif mod(corners(i,2),60)>0
                                   corners(i,2) = 60*floor(corners(i,2)/60);
                               end
                           end
                           
                           % Sort the corner points by column ascending
                           corners = sortrows(corners, 2);
                           
                           % Display the correct grid labels
                           imshow(src);
                           col = 'A';
                           row = 8;
                           elementRange = [60, 120, 180, 240, 300, 360, 420, 480];
                           for i = 1:size(elementRange,2)
                               for j = 1:size(corners, 1)
                                   if corners(j,1) >= elementRange(i)-60 && corners(j,1) < elementRange(i) && corners(j,2) < 480
                                       gridLabel = sprintf('%c%d', col, row);
                                       text(corners(j,1)+10, corners(j,2)+35, gridLabel, 'Color', 'r', 'FontSize', 18);
                           
                                       row = row - 1;
                                       if row == 0
                                           row = 8;
                                           col = col+1;
                                       end
                                   end
                               end
                           end
											</pre>
                        <!-- END CHANGES -->
                     </div>
                  </div>
               </div>
               <div class="sect3">
                  <h3 id="_opencv">OpenCV</h3>
                  <table class="tableblock frame-all grid-all" style=" width:100%; ">
                     <col style="width:50%;">
                     <col style="width:50%;">
                     <tbody>
                        <tr>
                           <td class="tableblock halign-left valign-top" >
                              <p class="tableblock"><span class="image">
                                 <img src="input/Part_1/p1_board.jpg" alt="input/Part_1/p1_board.jpg" width="100%">
                                 </span>
                              </p>
                           </td>
                           <td class="tableblock halign-left valign-top" >
                              <p class="tableblock">
                                 <span class="image">
                                    <!-- MAKE CHANGES HERE: Part 1 OpenCV Handle -->
                                    <img src="output/Part_1a/p1a_opencv_result.png" alt="Handle" width="100%">
                                    <!-- END CHANGES -->
                                 </span>
                              </p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
                  <div class="listingblock">
                     <div class="title">Source</div>
                     <div class="content monospaced">
                        <!-- MAKE CHANGES HERE: Part 1a OpenCV code -->
                        <pre>
                           #include <iostream>

                           #include <opencv2/opencv.hpp>
                           #include <opencv2/imgproc/imgproc.hpp>
                           #include <opencv2/highgui/highgui.hpp>
                           #include <opencv2/imgcodecs/imgcodecs.hpp>
                           
                           using namespace std;
                           using namespace cv;
                           
                           void displayBoardGridOverlay(Mat src, Mat dst, string title);
                           
                           int main()
                           {
                                 char keyPress;
                                 cout << "p1_opencv\n";
                                 // Read image
                                 Mat src1 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_1\\p1_board.jpg", IMREAD_GRAYSCALE);
                                 Mat dst1 = src1.clone();
                           
                                 // Create constant border for grid detectioon
                                 copyMakeBorder(src1, src1, 1, 1, 1, 1, BORDER_CONSTANT, Scalar(255));
                           
                                 // Run function to display location overlay
                                 displayBoardGridOverlay(src1, dst1, "Results 1");
                           
                                 while(1)
                                 {
                                    keyPress = waitKey();
                                    // Press q key to close window
                                    if (keyPress == 'q')
                                    {
                                       destroyAllWindows();
                                       break;
                                    }
                                 }
                                 return 0;
                           }
                           
                           void displayBoardGridOverlay(Mat src, Mat dst, string title) {
                                 cvtColor(src, dst, COLOR_GRAY2BGR);
                                 Mat border = src.clone();
                           
                                 // Invert colors and apply threshold to isolate border and grids
                                 bitwise_not(src, src);
                                 threshold(src, src, 50, 255, THRESH_BINARY);
                           
                                 threshold(border, border, 248, 100, THRESH_BINARY);
                           
                                 // Apply morphology to clean up border
                                 int elementValue = 5;
                                 Mat element = getStructuringElement( MORPH_RECT, Size( 2*elementValue + 1, 2*elementValue+1 ), Point( elementValue, elementValue ) );
                                 morphologyEx( border, border, MORPH_CLOSE, element );
                           
                                 src = src + border;
                           
                                 // Apply Canny edge detection to display clear lines
                                 Canny(src, src, 100, 100);
                           
                                 Mat se = getStructuringElement( MORPH_RECT, Size( 3, 3 ), Point( 1, 1 ));
                                 dilate(src, src, se);
                           
                                 // Connect disconnected lines from prior morph operation
                                 se = getStructuringElement( MORPH_RECT, Size( 3, 3 ), Point( 1, 1 ));
                                 morphologyEx( src, src, MORPH_CLOSE, element );
                           
                                 // Pull the vertical and horizontal lines from the image
                                 Mat vert;
                                 Mat horiz;
                                 int e = 100;
                                 se = getStructuringElement( MORPH_RECT, Size( 2*e + 1, 1 ), Point( e, 0 ) );
                                 morphologyEx( src, horiz, MORPH_OPEN, se );
                           
                                 se = getStructuringElement( MORPH_RECT, Size( 1, 2*e + 1 ), Point( 0, e ) );
                                 morphologyEx( src, vert, MORPH_OPEN, se );
                           
                                 // Store the grid for processing
                                 Mat grid = horiz + vert;
                           
                                 imshow("grid", grid);
                           
                                 Mat resb;
                                 grid.convertTo(resb, CV_8U, 255);
                           
                                 // Find the contours of the grayscale match result (these will be all the points where A's are located)
                                 vector<vector<Point>> contours;
                                 findContours(resb, contours, RETR_LIST, CHAIN_APPROX_SIMPLE);
                           
                                 // Contour sorter source: https://answers.opencv.org/question/31515/sorting-contours-from-left-to-right-and-top-to-bottom/
                                 // The countour sorter from this source was modified for application to this problem
                                 struct contour_sorter // 'less' for contours
                                 {
                                    bool operator ()( const vector<Point>& a, const vector<Point> & b )
                                    {
                                       Rect ra(boundingRect(a));
                                       Rect rb(boundingRect(b));
                                       // Sort contours from left to right, up to down on the grid
                                       if (abs(ra.y-rb.y) < 5) {
                                             return ra.x < rb.x;
                                       } else {
                                             return ( (ra.x + 1000*ra.y) < (rb.x + 1000*rb.y) );
                                       }
                                    }
                                 };
                           
                                 // apply it to the contours:
                                 std::sort(contours.begin(), contours.end(), contour_sorter());
                           
                                 // Display the square labels on the grid
                                 char col = 'A';
                                 int row = 8;
                           
                                 // Display text
                                 int lastX = -64;
                                 for (uint i=0; i<contours.size(); ++i)
                                 {
                                    // Display text for each bounding box in grid
                                    if (contourArea(contours[i]) > 2500) {
                                       Rect bound = boundingRect(contours[i]);
                                       if (abs(bound.x - lastX) > 50) {
                                             std::string s(1, col);
                                             string text = s + std::to_string(row);
                                             putText(dst, text, Point(bound.x+10, bound.y+35), FONT_HERSHEY_TRIPLEX, 1, Scalar(0, 0, 255), 3);
                                             col++;
                           
                                             if (col == 'I') {
                                                col = 'A';
                                                row--;
                                             }
                                             lastX = bound.x;
                                       }
                                    }
                                 }
                           
                                 // Display result
                                 imshow(title, dst);
                           }                              
											</pre>
                        <!-- END CHANGES -->
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div class="sect1">
            <h2 id="_part_1d">Part 1B</h2>
            <div class="sectionbody">
               <div class="paragraph">
                  <p>Write <strong>two</strong> programs, one with Matlab <strong>and</strong>
                 another with OpenCV. Each of the two programs should flip the
                 color of all squares, i.e., black to white, and white to black.
                  </p>
               </div>
               <div class="sect2">
                  <h3 id="_matlab1d">Matlab</h3>
                  <table class="tableblock frame-all grid-all" style=" width:100%; ">
                     <col style="width:50%;">
                     <col style="width:50%;">
                     <tbody>
                     <tr>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                                 <img src="input/Part_1/p1_board.jpg" alt="input/Part_1/p1_board.jpg" width="100%">
                                 </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                                 <span class="image">
                                    <!-- MAKE CHANGES HERE: Part 1 MATLAB Handle -->
                                    <img src="output/Part_1b/p1b_matlab_result.png" alt="Handle" width="100%">
                                    <!-- END CHANGES -->
                                 </span>
                           </p>
                        </td>
                     </tr>
                     </tbody>
                  </table>
                  <div class="listingblock">
                     <div class="title">Source</div>
                     <div class="content monospaced">
                        <!-- MAKE CHANGES HERE: Part 1b MATLAB code -->
                        <pre>% Read image
                           src = imread('C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_1\\p1_board.jpg');
                           
                           % Apply threshold to convert the black and white spots on board to black and white
                           src(src>225) = 255;
                           src(src<=225) = 0;
                           
                           % Convert all white pixels to green and all black pixels to red
                           src(src==255) = 160;
                           src(src==0) = 240;
                           
                           imshow(src);
											</pre>
                        <!-- END CHANGES -->
                     </div>
                  </div>
               </div>
               <div class="sect3">
                  <h3 id="_opencv1d">OpenCV</h3>
                  <table class="tableblock frame-all grid-all" style=" width:100%; ">
                     <col style="width:50%;">
                     <col style="width:50%;">
                     <tbody>
                     <tr>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                                 <img src="input/Part_1/p1_board.jpg" alt="input/Part_1/p1_board.jpg" width="100%">
                                 </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                                 <span class="image">
                                    <!-- MAKE CHANGES HERE: Part 1b OpenCV Handle -->
                                    <img src="output/Part_1b/p1b_opencv_result.png" alt="Handle" width="100%">
                                    <!-- END CHANGES -->
                                 </span>
                           </p>
                        </td>
                     </tr>
                     </tbody>
                  </table>
                  <div class="listingblock">
                     <div class="title">Source</div>
                     <div class="content monospaced">
                        <!-- MAKE CHANGES HERE: Part 1b OpenCV code -->
                        <pre>#include <iostream>

                           #include <opencv2/opencv.hpp>
                           #include <opencv2/imgproc/imgproc.hpp>
                           #include <opencv2/highgui/highgui.hpp>
                           #include <opencv2/imgcodecs/imgcodecs.hpp>
                           
                           using namespace std;
                           using namespace cv;
                           
                           int main()
                           {
                               char keyPress;
                               cout << "p1_opencv\n";
                           
                               // Read image
                               Mat src = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_1\\p1_board.jpg", IMREAD_GRAYSCALE);
                           
                               // Apply threshold to convert the black and white spots on board to black and white
                               threshold(src, src, 225, 255, THRESH_BINARY);
                           
                               // Flip the colors of the black and white squares
                               Mat mask;
                               inRange(src, Scalar(255), Scalar(255), mask);
                               src.setTo(Scalar(160), mask);
                               inRange(src, Scalar(0), Scalar(0), mask);
                               src.setTo(Scalar(240), mask);
                           
                               // Display results
                               imshow("Input", src);
                           
                               while(1)
                               {
                                   keyPress = waitKey();
                                   // Press q key to close window
                                   if (keyPress == 'q')
                                   {
                                       destroyAllWindows();
                                       break;
                                   }
                               }
                               return 0;
                           }                           
											</pre>
                        <!-- END CHANGES -->
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div class="sect1">
            <h2 id="_part_2a">Part 2A</h2>
            <div class="sectionbody">
               <div class="paragraph">
                  <p>Write <strong>two</strong> programs, one with Matlab
                 <strong>and</strong> another with OpenCV. Each program should find all pawns
                 in the chessboard images below and highlight them
                 (e.g., by drawing a bounding box around the pawn with a bright color).
                  </p>
               </div>
               <table class="tableblock frame-all grid-all" style=" width:100%; ">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <tbody>
                     <tr>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                              <img src="input/Part_2/p2_board_1.jpg" alt="input/Part_2/p2_board_1.jpg" width="100%">
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                              <img src="input/Part_2/p2_board_2.jpg" alt="input/Part_2/p2_board_2.jpg" width="100%">
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                              <img src="input/Part_2/p2_board_3.jpg" alt="input/Part_2/p2_board_3.jpg" width="100%">
                              </span>
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2a image 1 matlab -->
                                 <img src="output/Part_2a/placeholder.jpg" alt="output/Part_2a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2a image 2 matlab -->
                                 <img src="output/Part_2a/placeholder.jpg" alt="output/Part_2a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2a image 3 matlab -->
                                 <img src="output/Part_2a/placeholder.jpg" alt="output/Part_2a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                     <tr>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2a image 1 OpenCV -->
                                 <img src="output/Part_2a/p2a_opencv_result_1.png" alt="output/Part_2a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2a image 2 OpenCV -->
                                 <img src="output/Part_2a/p2a_opencv_result_2.png" alt="output/Part_2a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2a image 3 OpenCV -->
                                 <img src="output/Part_2a/p2a_opencv_result_3.png" alt="output/Part_2a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                     </tr>
                  </tbody>
               </table>
               <div class="listingblock">
                  <div class="title">Source (Matlab)</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 2 code -->
                     <pre>
// Insert your Matlab code here
										</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
               <div class="listingblock">
                  <div class="title">Source (OpenCV)</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 2 code -->
                     <pre>
                        #include <iostream>

                        #include <opencv2/opencv.hpp>
                        #include <opencv2/imgproc/imgproc.hpp>
                        #include <opencv2/highgui/highgui.hpp>
                        #include <opencv2/imgcodecs/imgcodecs.hpp>
                        
                        using namespace std;
                        using namespace cv;
                        
                        void processPieceMatch(Mat src, Mat hl, Mat temp);
                        
                        int main()
                        {
                              char keyPress;
                              cout << "p1_opencv\n";
                              // Read image
                              Mat src1 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_2\\p2_board_1.jpg", IMREAD_GRAYSCALE);
                              Mat src2 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_2\\p2_board_2.jpg", IMREAD_GRAYSCALE);
                              Mat src3 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_2\\p2_board_3.jpg", IMREAD_GRAYSCALE);
                        
                              // Load the knight chess piece templates
                              Mat bpd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackPawnDark.jpg", IMREAD_GRAYSCALE);
                              Mat bpl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackPawnLight.jpg", IMREAD_GRAYSCALE);
                              Mat wpd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whitePawnDark.jpg", IMREAD_GRAYSCALE);
                              Mat wpl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whitePawnLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat pieceTemplates[] = {bpd, bpl, wpd, wpl};
                              int numPieceTemplates = 4;
                        
                              Mat dst1;
                              Mat dst2;
                              Mat dst3;
                              cvtColor(src1, dst1, COLOR_GRAY2BGR);
                              cvtColor(src2, dst2, COLOR_GRAY2BGR);
                              cvtColor(src3, dst3, COLOR_GRAY2BGR);
                        
                              for (int i = 0; i < 4; i++) {
                                 processPieceMatch(src1, dst1, pieceTemplates[i]);
                                 processPieceMatch(src2, dst2, pieceTemplates[i]);
                                 processPieceMatch(src3, dst3, pieceTemplates[i]);
                              }
                        
                              // Display results
                              imshow("Board 1 Results", dst1);
                              imshow("Board 2 Results", dst2);
                              imshow("Board 3 Results", dst3);
                        
                              while(1)
                              {
                                 keyPress = waitKey();
                                 // Press q key to close window
                                 if (keyPress == 'q')
                                 {
                                    destroyAllWindows();
                                    break;
                                 }
                              }
                              return 0;
                        }
                        
                        // Source: https://stackoverflow.com/questions/32041063/multiple-template-matching-only-detects-one-match/32095085#32095085
                        // This code is based on the solution at this link
                        void processPieceMatch(Mat src, Mat hl, Mat temp) {
                              // Match the A template on the grid
                              Mat1f result;
                              matchTemplate(src, temp, result, TM_CCOEFF_NORMED);
                        
                              // Replace all pixels with a value less than 0.95 with 0, so they are not processed as a match (confidence threshold)
                              double thresh = 0.7;
                              threshold(result, result, thresh, 1., THRESH_BINARY);
                        
                              // Convert result to CV_8U to support finding contours
                              Mat resb;
                              result.convertTo(resb, CV_8U, 255);
                        
                              // Find the contours of the grayscale match result
                              vector<vector<Point>> contours;
                              findContours(resb, contours, RETR_LIST, CHAIN_APPROX_SIMPLE);
                        
                              // Process each matching A
                              for (uint i=0; i<contours.size(); ++i)
                              {
                                 // Mask out all other matching A's except the one that corresponds to the current contour
                                 Mat mask(result.rows, result.cols, uchar(0));
                                 drawContours(mask, contours, i, Scalar(255), FILLED);
                        
                                 // Find the maximum matching location
                                 Point max_point;
                                 double max_val;
                                 minMaxLoc(result, NULL, &max_val, NULL, &max_point, mask);
                        
                                 // Draw the font in different colors
                                 rectangle(hl, Rect(max_point.x, max_point.y, temp.cols, temp.rows), Scalar(0, 0, 255), 5);
                              }
                        }                           
										</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
            </div>
         </div>
         <div class="sect1">
            <h2 id="_part_2b">Part 2B</h2>
            <div class="sectionbody">
               <div class="paragraph">
                  <p>Count the number of black pawns and white pawns and place
                 each pawn's index, starting from one, as a text overlay over each pawn accordingly.
                 Thus, for example, the pawn in &apos;a2&apos; gets the index
                 1;, the pawn in &apos;b2&apos; gets the index 2, and so forth
                 until the last pawn gets the index 16.</p>
                 <p> This part requires two programs, one in Matlab
                 <strong>and</strong> another with OpenCV. Your program can count black
                 and white pawns separately or it can count all pawns regardless
                 of their color.
                  </p>
               </div>
               <table class="tableblock frame-all grid-all" style=" width:100%; ">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <tbody>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_2/p2_board_1.jpg" alt="input/Part_2/p2_board_1.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_2/p2_board_2.jpg" alt="input/Part_2/p2_board_2.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_2/p2_board_3.jpg" alt="input/Part_2/p2_board_3.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2b image 1 Matlab -->
                                 <img src="output/Part_2b/placeholder.jpg" alt="output/Part_2b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2b image 2 Matlab -->
                                 <img src="output/Part_2b/placeholder.jpg" alt="output/Part_2b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2b image 3 Matlab -->
                                 <img src="output/Part_2b/placeholder.jpg" alt="output/Part_2b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2b image 1 OpenCV -->
                                 <img src="output/Part_2b/p2b_opencv_result_1.png" alt="output/Part_2b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2b image 2 OpenCV -->
                                 <img src="output/Part_2b/p2b_opencv_result_2.png" alt="output/Part_2b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2b image 3 OpenCV -->
                                 <img src="output/Part_2b/p2b_opencv_result_3.png" alt="output/Part_2b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                  </tr>
                  </tbody>
               </table>
               <div class="listingblock">
                  <div class="title">Source (Matlab)</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 2b code -->
                     <pre>
// Insert your Matlab code here
										</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
               <div class="listingblock">
                  <div class="title">Source (OpenCV)</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 2b code -->
                     <pre>
                        #include <iostream>

                        #include <opencv2/opencv.hpp>
                        #include <opencv2/imgproc/imgproc.hpp>
                        #include <opencv2/highgui/highgui.hpp>
                        #include <opencv2/imgcodecs/imgcodecs.hpp>
                        
                        using namespace std;
                        using namespace cv;
                        
                        bool board1[8][8];
                        bool board2[8][8];
                        bool board3[8][8];
                        
                        void processPieceMatch(Mat src, Mat temp, int board);
                        
                        int main()
                        {
                              char keyPress;
                              cout << "p1_opencv\n";
                              // Read image
                              Mat src1 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_2\\p2_board_1.jpg", IMREAD_GRAYSCALE);
                              Mat src2 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_2\\p2_board_2.jpg", IMREAD_GRAYSCALE);
                              Mat src3 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_2\\p2_board_3.jpg", IMREAD_GRAYSCALE);
                        
                              // Load the knight chess piece templates
                              Mat bpd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackPawnDark.jpg", IMREAD_GRAYSCALE);
                              Mat bpl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackPawnLight.jpg", IMREAD_GRAYSCALE);
                              Mat wpd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whitePawnDark.jpg", IMREAD_GRAYSCALE);
                              Mat wpl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whitePawnLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat pieceTemplates[] = {bpd, bpl, wpd, wpl};
                              int numPieceTemplates = 4;
                        
                              Mat dst1;
                              Mat dst2;
                              Mat dst3;
                              cvtColor(src1, dst1, COLOR_GRAY2BGR);
                              cvtColor(src2, dst2, COLOR_GRAY2BGR);
                              cvtColor(src3, dst3, COLOR_GRAY2BGR);
                        
                              for (int i = 0; i < 4; i++) {
                                 processPieceMatch(src1, pieceTemplates[i], 1);
                                 processPieceMatch(src2, pieceTemplates[i], 2);
                                 processPieceMatch(src3, pieceTemplates[i], 3);
                              }
                        
                              // Loop through the board and put the overlay where there is a pawn
                              int index1 = 1;
                              int index2 = 1;
                              int index3 = 1;
                              for (int i = 0; i < 8; i++) {
                                 for (int j = 0; j < 8; j++) {
                                    if (board1[j][i]) {
                                          putText(dst1, std::to_string(index1++), Point(j*60+10, i*60+35), FONT_HERSHEY_TRIPLEX, 1, Scalar(0, 0, 255), 3);
                                    }
                                    if (board2[j][i]) {
                                          putText(dst2, std::to_string(index2++), Point(j*60+10, i*60+35), FONT_HERSHEY_TRIPLEX, 1, Scalar(0, 0, 255), 3);
                                    }
                                    if (board3[j][i]) {
                                          putText(dst3, std::to_string(index3++), Point(j*60+10, i*60+35), FONT_HERSHEY_TRIPLEX, 1, Scalar(0, 0, 255), 3);
                                    }
                                 }
                              }
                        
                              // Display results
                              imshow("Board 1 Results", dst1);
                              imshow("Board 2 Results", dst2);
                              imshow("Board 3 Results", dst3);
                        
                              while(1)
                              {
                                 keyPress = waitKey();
                                 // Press q key to close window
                                 if (keyPress == 'q')
                                 {
                                    destroyAllWindows();
                                    break;
                                 }
                              }
                              return 0;
                        }
                        
                        // Source: https://stackoverflow.com/questions/32041063/multiple-template-matching-only-detects-one-match/32095085#32095085
                        // This code is based on the solution at this link
                        void processPieceMatch(Mat src, Mat temp, int board) {
                              // Match the A template on the grid
                              Mat1f result;
                              matchTemplate(src, temp, result, TM_CCOEFF_NORMED);
                        
                              // Replace all pixels with a value less than 0.95 with 0, so they are not processed as a match (confidence threshold)
                              double thresh = 0.95;
                              threshold(result, result, thresh, 1., THRESH_BINARY);
                        
                              // Convert result to CV_8U to support finding contours
                              Mat resb;
                              result.convertTo(resb, CV_8U, 255);
                        
                              // Find the contours of the grayscale match result
                              vector<vector<Point>> contours;
                              findContours(resb, contours, RETR_LIST, CHAIN_APPROX_SIMPLE);
                        
                              // Process each matching A
                              for (uint i=0; i<contours.size(); ++i)
                              {
                                 // Mask out all other matching A's except the one that corresponds to the current contour
                                 Mat mask(result.rows, result.cols, uchar(0));
                                 drawContours(mask, contours, i, Scalar(255), FILLED);
                        
                                 // Find the maximum matching location
                                 Point max_point;
                                 double max_val;
                                 minMaxLoc(result, NULL, &max_val, NULL, &max_point, mask);
                        
                                 // Signal that a pawn was found at the current location
                                 if (board == 1) {
                                    board1[max_point.x/60][max_point.y/60] = true;
                                 } else if (board == 2) {
                                    board2[max_point.x/60][max_point.y/60] = true;
                                 } else {
                                    board3[max_point.x/60][max_point.y/60] = true;
                                 }
                              }
                        }                           
										</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
            </div>
         </div>
         <div class="sect1">
            <h2 id="_part_2c">Part 2C</h2>
            <div class="sectionbody">
               <div class="paragraph">
                  <p>Flip the colors of all pawns so that white becomes black
                 and black becomes white.
                 This part requires two programs, one in Matlab
                 <strong>and</strong> another with OpenCV. Your program can count black
                 and white pawns separately or it can count all pawns regardless
                 of their color.
                  </p>
               </div>
               <table class="tableblock frame-all grid-all" style=" width:100%; ">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <tbody>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_2/p2_board_1.jpg" alt="input/Part_2/p2_board_1.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_2/p2_board_2.jpg" alt="input/Part_2/p2_board_2.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_2/p2_board_3.jpg" alt="input/Part_2/p2_board_3.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2c image 1 Matlab -->
                                 <img src="output/Part_2c/placeholder.jpg" alt="output/Part_2c/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2c image 2 Matlab -->
                                 <img src="output/Part_2c/placeholder.jpg" alt="output/Part_2c/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2c image 3 Matlab -->
                                 <img src="output/Part_2c/placeholder.jpg" alt="output/Part_2c/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2c image 1 OpenCV -->
                                 <img src="output/Part_2c/p2c_opencv_result_1.png" alt="output/Part_2c/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2c image 2 OpenCV -->
                                 <img src="output/Part_2c/p2c_opencv_result_2.png" alt="output/Part_2c/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 2c image 3 OpenCV -->
                                 <img src="output/Part_2c/p2c_opencv_result_3.png" alt="output/Part_2c/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                  </tr>
                  </tbody>
               </table>
               <div class="listingblock">
                  <div class="title">Source (Matlab)</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 2c code -->
                     <pre>
// Insert your Matlab code here
										</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
               <div class="listingblock">
                  <div class="title">Source (OpenCV)</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 2c code -->
                     <pre>
                        #include <iostream>

                        #include <opencv2/opencv.hpp>
                        #include <opencv2/imgproc/imgproc.hpp>
                        #include <opencv2/highgui/highgui.hpp>
                        #include <opencv2/imgcodecs/imgcodecs.hpp>
                        
                        using namespace std;
                        using namespace cv;
                        
                        void processPieceMatch(Mat src, Mat dst, Mat temp, Mat replacementTemp, double thresh);
                        
                        int main()
                        {
                              char keyPress;
                              cout << "p2c_opencv\n";
                              // Read image
                              Mat src1 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_2\\p2_board_1.jpg", IMREAD_GRAYSCALE);
                              Mat src2 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_2\\p2_board_2.jpg", IMREAD_GRAYSCALE);
                              Mat src3 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_2\\p2_board_3.jpg", IMREAD_GRAYSCALE);
                        
                              // Load the knight chess piece templates
                              Mat bpd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackPawnDark.jpg", IMREAD_GRAYSCALE);
                              Mat bpl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackPawnLight.jpg", IMREAD_GRAYSCALE);
                              Mat wpd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whitePawnDark.jpg", IMREAD_GRAYSCALE);
                              Mat wpl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whitePawnLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat dst1 = src1.clone();
                              Mat dst2 = src2.clone();
                              Mat dst3 = src3.clone();
                        
                              // Detect pawn positions and flip colors
                              processPieceMatch(src1, dst1, wpd, bpd, 0.95);
                              processPieceMatch(src1, dst1, wpl, bpl, 0.95);
                              processPieceMatch(src1, dst1, bpd, wpd, 0.999);
                              processPieceMatch(src1, dst1, bpl, wpl, 0.9998);
                        
                              processPieceMatch(src2, dst2, wpd, bpd, 0.95);
                              processPieceMatch(src2, dst2, wpl, bpl, 0.95);
                              processPieceMatch(src2, dst2, bpd, wpd, 0.999);
                              processPieceMatch(src2, dst2, bpl, wpl, 0.9998);
                        
                              processPieceMatch(src3, dst3, wpd, bpd, 0.95);
                              processPieceMatch(src3, dst3, wpl, bpl, 0.95);
                              processPieceMatch(src3, dst3, bpd, wpd, 0.999);
                              processPieceMatch(src3, dst3, bpl, wpl, 0.9998);
                        
                              // Display results
                              imshow("Board 1 Results", dst1);
                              imshow("Board 2 Results", dst2);
                              imshow("Board 3 Results", dst3);
                        
                              while(1)
                              {
                                 keyPress = waitKey();
                                 // Press q key to close window
                                 if (keyPress == 'q')
                                 {
                                    destroyAllWindows();
                                    break;
                                 }
                              }
                              return 0;
                        }
                        
                        // Source: https://stackoverflow.com/questions/32041063/multiple-template-matching-only-detects-one-match/32095085#32095085
                        // This code is based on the solution at this link
                        void processPieceMatch(Mat src, Mat dst, Mat temp, Mat replacementTemp, double thresh) {
                              // Match the A template on the grid
                              Mat1f result;
                              matchTemplate(src, temp, result, TM_CCOEFF_NORMED);
                        
                              // Replace all pixels with a value less than 0.95 with 0, so they are not processed as a match (confidence threshold)
                              threshold(result, result, thresh, 1., THRESH_BINARY);
                        
                              // Convert result to CV_8U to support finding contours
                              Mat resb;
                              result.convertTo(resb, CV_8U, 255);
                        
                              // Find the contours of the grayscale match result
                              vector<vector<Point>> contours;
                              findContours(resb, contours, RETR_LIST, CHAIN_APPROX_SIMPLE);
                        
                              // Process each matching A
                              for (uint i=0; i<contours.size(); ++i)
                              {
                                 // Mask out all other matching A's except the one that corresponds to the current contour
                                 Mat mask(result.rows, result.cols, uchar(0));
                                 drawContours(mask, contours, i, Scalar(255), FILLED);
                        
                                 // Find the maximum matching location
                                 Point max_point;
                                 double max_val;
                                 minMaxLoc(result, NULL, &max_val, NULL, &max_point, mask);
                        
                                 // Replace the pixels at this pawn with the pixels for the flipped color
                                 Rect roi(max_point.x, max_point.y, 59, 59);
                                 replacementTemp.copyTo(dst(roi));
                              }
                        }                           
										</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
            </div>
         </div>
         <div class="sect1">
            <h2 id="_part_3a">Part 3A</h2>
            <div class="sectionbody">
               <div class="paragraph">
                  <p>Write a program to find all rooks and highlight them (fill in the rook with another color).
                     Solve this and all subsequent problems using either MATLAB
                 <strong>or</strong> OpenCV. That is, only one program is
                 necessary starting from Part 3A.</p>
               </div>
               <table class="tableblock frame-all grid-all" style=" width:100%; ">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <tbody>
                     <tr>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                              <img src="input/Part_3/p3_board_1.jpg" alt="input/Part_3/p3_board_1.jpg" width="100%">
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                              <img src="input/Part_3/p3_board_2.jpg" alt="input/Part_3/p3_board_2.jpg" width="100%">
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                              <img src="input/Part_3/p3_board_3.jpg" alt="input/Part_3/p3_board_3.jpg" width="100%">
                              </span>
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 3a image 1 -->
                                 <img src="output/Part_3a/p3a_opencv_result_1.png" alt="output/Part_3a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 3a image 2 -->
                                 <img src="output/Part_3a/p3a_opencv_result_2.png" alt="output/Part_3a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 3a image 3 -->
                                 <img src="output/Part_3a/p3a_opencv_result_3.png" alt="output/Part_3a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                     </tr>
                  </tbody>
               </table>
               <div class="listingblock">
                  <div class="title">Source</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 3a code -->
                     <pre>
                        #include <iostream>

                        #include <opencv2/opencv.hpp>
                        #include <opencv2/imgproc/imgproc.hpp>
                        #include <opencv2/highgui/highgui.hpp>
                        #include <opencv2/imgcodecs/imgcodecs.hpp>
                        
                        using namespace std;
                        using namespace cv;
                        
                        void processPieceMatch(Mat src, Mat hl, Mat temp, Mat replacementTemp);
                        void processColorChange(Mat src);
                        void colorRooks(Mat temp, Mat hlTemp);
                        
                        int main()
                        {
                              char keyPress;
                              cout << "p1_opencv\n";
                              // Read image
                              Mat src1 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_3\\p3_board_1.jpg", IMREAD_GRAYSCALE);
                              Mat src2 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_3\\p3_board_2.jpg", IMREAD_GRAYSCALE);
                              Mat src3 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_3\\p3_board_3.jpg", IMREAD_GRAYSCALE);
                        
                              // Load the knight chess piece templates
                              Mat brd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackRookDark.jpg", IMREAD_GRAYSCALE);
                              Mat brl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackRookLight.jpg", IMREAD_GRAYSCALE);
                              Mat wrd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteRookDark.jpg", IMREAD_GRAYSCALE);
                              Mat wrl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteRookLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat pieceTemplates[] = {brd, brl, wrd, wrl};
                              int numPieceTemplates = 4;
                        
                              Mat dst1;
                              Mat dst2;
                              Mat dst3;
                              cvtColor(src1, dst1, COLOR_GRAY2BGR);
                              cvtColor(src2, dst2, COLOR_GRAY2BGR);
                              cvtColor(src3, dst3, COLOR_GRAY2BGR);
                        
                              // Fill in the piece wil the color
                              Mat brdc = brd.clone();
                              Mat brlc = brl.clone();
                              Mat wrdc = wrd.clone();
                              Mat wrlc = wrl.clone();
                              cvtColor(brdc, brdc, COLOR_GRAY2BGR);
                              cvtColor(brlc, brlc, COLOR_GRAY2BGR);
                              cvtColor(wrdc, wrdc, COLOR_GRAY2BGR);
                              cvtColor(wrlc, wrlc, COLOR_GRAY2BGR);
                              Mat pieceTemplatesReplacements[] = {brdc, brlc, wrdc, wrlc};
                        
                              // TODO: Create a function to change the color of the pieces (0 and 255 to red)
                              for (int i = 0; i < 4; i++) {
                                 colorRooks(pieceTemplates[i], pieceTemplatesReplacements[i]);
                              }
                        
                              for (int i = 0; i < 4; i++) {
                                 processPieceMatch(src1, dst1, pieceTemplates[i], pieceTemplatesReplacements[i]);
                                 processPieceMatch(src2, dst2, pieceTemplates[i], pieceTemplatesReplacements[i]);
                                 processPieceMatch(src3, dst3, pieceTemplates[i], pieceTemplatesReplacements[i]);
                              }
                        
                              // Display results
                              imshow("Board 1 Results", dst1);
                              imshow("Board 2 Results", dst2);
                              imshow("Board 3 Results", dst3);
                        
                              while(1)
                              {
                                 keyPress = waitKey();
                                 // Press q key to close window
                                 if (keyPress == 'q')
                                 {
                                    destroyAllWindows();
                                    break;
                                 }
                              }
                              return 0;
                        }
                        
                        // Source: https://stackoverflow.com/questions/32041063/multiple-template-matching-only-detects-one-match/32095085#32095085
                        // This code is based on the solution at this link
                        void processPieceMatch(Mat src, Mat dst, Mat temp, Mat replacementTemp) {
                              // Match the A template on the grid
                              Mat1f result;
                              matchTemplate(src, temp, result, TM_CCOEFF_NORMED);
                        
                              // Replace all pixels with a value less than 0.95 with 0, so they are not processed as a match (confidence threshold)
                              double thresh = 0.95;
                              threshold(result, result, thresh, 1., THRESH_BINARY);
                        
                              // Convert result to CV_8U to support finding contours
                              Mat resb;
                              result.convertTo(resb, CV_8U, 255);
                        
                              // Find the contours of the grayscale match result
                              vector<vector<Point>> contours;
                              findContours(resb, contours, RETR_LIST, CHAIN_APPROX_SIMPLE);
                        
                              // Process each matching A
                              for (uint i=0; i<contours.size(); ++i)
                              {
                                 // Mask out all other matching A's except the one that corresponds to the current contour
                                 Mat mask(result.rows, result.cols, uchar(0));
                                 drawContours(mask, contours, i, Scalar(255), FILLED);
                        
                                 // Find the maximum matching location
                                 Point max_point;
                                 double max_val;
                                 minMaxLoc(result, NULL, &max_val, NULL, &max_point, mask);
                        
                                 // Draw the font in different colors
                                 Rect roi(max_point.x, max_point.y, 59, 59);
                                 replacementTemp.copyTo(dst(roi));
                              }
                        }
                        
                        // Highlights the rooks
                        void colorRooks(Mat temp, Mat hlTemp) {
                              Mat resb;
                              Mat oTemp = temp.clone();
                              threshold(oTemp, oTemp, 246, 255, THRESH_BINARY);
                              oTemp.convertTo(resb, CV_8U, 255);
                        
                              // Find the contours of the grayscale match result
                              vector<vector<Point>> contours;
                              findContours(resb, contours, RETR_LIST, CHAIN_APPROX_SIMPLE);
                        
                              // Fill in the chess pieces
                              for (uint i=0; i<contours.size(); ++i)
                              {
                                 drawContours(hlTemp, contours, i, Scalar(0, 0, 255), FILLED);
                              }
                        }                           
										</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
            </div>
         </div>
         <div class="sect1">
            <h2 id="_part_3b">Part 3B</h2>
            <div class="sectionbody">
               <div class="paragraph">
                  <p>Modify your program to find all rooks, bishops, queens, and
                 highlight them with a bright color. Use three different
                 highlighting colors,
                 to differentiate between these three types of chess figures.
                 </p>
               </div>
               <table class="tableblock frame-all grid-all" style=" width:100%; ">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <tbody>
                     <tr>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                              <img src="input/Part_3/p3_board_1.jpg" alt="input/Part_3/p3_board_1.jpg" width="100%">
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                              <img src="input/Part_3/p3_board_2.jpg" alt="input/Part_3/p3_board_2.jpg" width="100%">
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                              <img src="input/Part_3/p3_board_3.jpg" alt="input/Part_3/p3_board_3.jpg" width="100%">
                              </span>
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 3b image 1 -->
                                 <img src="output/Part_3b/p3b_opencv_result_1.png" alt="output/Part_3b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 3b image 2 -->
                                 <img src="output/Part_3b/p3b_opencv_result_2.png" alt="output/Part_3b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 3b image 3 -->
                                 <img src="output/Part_3b/p3b_opencv_result_3.png" alt="output/Part_3b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                        
                     </tr>
                  </tbody>
               </table>
               <div class="listingblock">
                  <div class="title">Source</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 3b code -->
                     <pre>
                        #include <iostream>

                        #include <opencv2/opencv.hpp>
                        #include <opencv2/imgproc/imgproc.hpp>
                        #include <opencv2/highgui/highgui.hpp>
                        #include <opencv2/imgcodecs/imgcodecs.hpp>
                        
                        using namespace std;
                        using namespace cv;
                        
                        void processPieceMatch(Mat src, Mat hl, Mat temp, Mat replacementTemp);
                        void processColorChange(Mat src);
                        void colorPieces(Mat temp, Mat hlTemp, Scalar color);
                        
                        int main()
                        {
                              char keyPress;
                              cout << "p1_opencv\n";
                              // Read image
                              Mat src1 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_3\\p3_board_1.jpg", IMREAD_GRAYSCALE);
                              Mat src2 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_3\\p3_board_2.jpg", IMREAD_GRAYSCALE);
                              Mat src3 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_3\\p3_board_3.jpg", IMREAD_GRAYSCALE);
                        
                              // Load the knight chess piece templates
                              Mat brd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackRookDark.jpg", IMREAD_GRAYSCALE);
                              Mat brl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackRookLight.jpg", IMREAD_GRAYSCALE);
                              Mat wrd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteRookDark.jpg", IMREAD_GRAYSCALE);
                              Mat wrl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteRookLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat bbd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackBishopDark.jpg", IMREAD_GRAYSCALE);
                              Mat bbl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackBishopLight.jpg", IMREAD_GRAYSCALE);
                              Mat wbd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteBishopDark.jpg", IMREAD_GRAYSCALE);
                              Mat wbl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteBishopLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat bqd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackQueenDark.jpg", IMREAD_GRAYSCALE);
                              Mat bql = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackQueenLight.jpg", IMREAD_GRAYSCALE);
                              Mat wqd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteQueenDark.jpg", IMREAD_GRAYSCALE);
                              Mat wql = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteQueenLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat pieceTemplates[] = {brd,brl,wrd,wrl,bbd,bbl,wbd,wbl,bqd,bql,wqd,wql};
                              int numPieceTemplates = 12;
                        
                              Mat dst1;
                              Mat dst2;
                              Mat dst3;
                              cvtColor(src1, dst1, COLOR_GRAY2BGR);
                              cvtColor(src2, dst2, COLOR_GRAY2BGR);
                              cvtColor(src3, dst3, COLOR_GRAY2BGR);
                        
                              // Fill in the piece wil the color
                              Mat brdc = brd.clone();
                              Mat brlc = brl.clone();
                              Mat wrdc = wrd.clone();
                              Mat wrlc = wrl.clone();
                              Mat bbdc = bbd.clone();
                              Mat bblc = bbl.clone();
                              Mat wbdc = wbd.clone();
                              Mat wblc = wbl.clone();
                              Mat bqdc = bqd.clone();
                              Mat bqlc = bql.clone();
                              Mat wqdc = wqd.clone();
                              Mat wqlc = wql.clone();
                              cvtColor(brdc, brdc, COLOR_GRAY2BGR);
                              cvtColor(brlc, brlc, COLOR_GRAY2BGR);
                              cvtColor(wrdc, wrdc, COLOR_GRAY2BGR);
                              cvtColor(wrlc, wrlc, COLOR_GRAY2BGR);
                              cvtColor(bbdc, bbdc, COLOR_GRAY2BGR);
                              cvtColor(bblc, bblc, COLOR_GRAY2BGR);
                              cvtColor(wbdc, wbdc, COLOR_GRAY2BGR);
                              cvtColor(wblc, wblc, COLOR_GRAY2BGR);
                              cvtColor(bqdc, bqdc, COLOR_GRAY2BGR);
                              cvtColor(bqlc, bqlc, COLOR_GRAY2BGR);
                              cvtColor(wqdc, wqdc, COLOR_GRAY2BGR);
                              cvtColor(wqlc, wqlc, COLOR_GRAY2BGR);
                              Mat pieceTemplatesReplacements[] = {brdc,brlc,wrdc,wrlc,bbdc,bblc,wbdc,wblc,bqdc,bqlc,wqdc,wqlc};
                        
                              // Fill in chess pieces
                              Scalar colors[] = {Scalar(0, 0, 255), Scalar(0, 128, 255), Scalar(255, 255, 0)};
                              for (int i = 0; i < numPieceTemplates; i++) {
                                 colorPieces(pieceTemplates[i], pieceTemplatesReplacements[i], colors[i/4]);
                              }
                        
                              for (int i = 0; i < numPieceTemplates; i++) {
                                 processPieceMatch(src1, dst1, pieceTemplates[i], pieceTemplatesReplacements[i]);
                                 processPieceMatch(src2, dst2, pieceTemplates[i], pieceTemplatesReplacements[i]);
                                 processPieceMatch(src3, dst3, pieceTemplates[i], pieceTemplatesReplacements[i]);
                              }
                        
                              // Display results
                              imshow("Board 1 Results", dst1);
                              imshow("Board 2 Results", dst2);
                              imshow("Board 3 Results", dst3);
                        
                              while(1)
                              {
                                 keyPress = waitKey();
                                 // Press q key to close window
                                 if (keyPress == 'q')
                                 {
                                    destroyAllWindows();
                                    break;
                                 }
                              }
                              return 0;
                        }
                        
                        // Source: https://stackoverflow.com/questions/32041063/multiple-template-matching-only-detects-one-match/32095085#32095085
                        // This code is based on the solution at this link
                        void processPieceMatch(Mat src, Mat dst, Mat temp, Mat replacementTemp) {
                              // Match the A template on the grid
                              Mat1f result;
                              matchTemplate(src, temp, result, TM_CCOEFF_NORMED);
                        
                              // Replace all pixels with a value less than 0.95 with 0, so they are not processed as a match (confidence threshold)
                              double thresh = 0.95;
                              threshold(result, result, thresh, 1., THRESH_BINARY);
                        
                              // Convert result to CV_8U to support finding contours
                              Mat resb;
                              result.convertTo(resb, CV_8U, 255);
                        
                              // Find the contours of the grayscale match result
                              vector<vector<Point>> contours;
                              findContours(resb, contours, RETR_LIST, CHAIN_APPROX_SIMPLE);
                        
                              // Process each matching A
                              for (uint i=0; i<contours.size(); ++i)
                              {
                                 // Mask out all other matching A's except the one that corresponds to the current contour
                                 Mat mask(result.rows, result.cols, uchar(0));
                                 drawContours(mask, contours, i, Scalar(255), FILLED);
                        
                                 // Find the maximum matching location
                                 Point max_point;
                                 double max_val;
                                 minMaxLoc(result, NULL, &max_val, NULL, &max_point, mask);
                        
                                 // Draw the font in different colors
                                 Rect roi(max_point.x, max_point.y, 59, 59);
                                 replacementTemp.copyTo(dst(roi));
                              }
                        }
                        
                        // Highlights the rooks
                        void colorPieces(Mat temp, Mat hlTemp, Scalar color) {
                              Mat resb;
                              Mat oTemp = temp.clone();
                              threshold(oTemp, oTemp, 246, 255, THRESH_BINARY);
                              oTemp.convertTo(resb, CV_8U, 255);
                        
                              // Find the contours of the grayscale match result
                              vector<vector<Point>> contours;
                              findContours(resb, contours, RETR_LIST, CHAIN_APPROX_SIMPLE);
                        
                              // Fill in the chess pieces
                              for (uint i=0; i<contours.size(); ++i)
                              {
                                 drawContours(hlTemp, contours, i, color, FILLED);
                              }
                        }                           
</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
            </div>
         </div>
         <div class="sect1">
            <h2 id="_part_4a">Part 4A</h2>
            <div class="sectionbody">
               <div class="paragraph">
                  <p>Detect all white pawns on the top line, and all black pawns
                  on the bottom line, and replace them with queens of the same
                  color. That is, replace all white pawns on line 8 with white queens and
                 all black pawns on line 1 with black queens. </p>
               </div>
               <table class="tableblock frame-all grid-all" style=" width:100%; ">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <tbody>
                     <tr>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                              <img src="input/Part_4/p4_board_1.jpg" alt="input/Part_4/p4_board_1.jpg" width="100%">
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                              <img src="input/Part_4/p4_board_2.jpg" alt="input/Part_4/p4_board_2.jpg" width="100%">
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                              <img src="input/Part_4/p4_board_3.jpg" alt="input/Part_4/p4_board_3.jpg" width="100%">
                              </span>
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 4a image 1 -->
                                 <img src="output/Part_4a/p4a_opencv_result_1.png" alt="output/Part_4a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 4a image 2 -->
                                 <img src="output/Part_4a/p4a_opencv_result_2.png" alt="output/Part_4a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 4a image 3 -->
                                 <img src="output/Part_4a/p4a_opencv_result_3.png" alt="output/Part_4a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                        
                     </tr>
                  </tbody>
               </table>
               <div class="listingblock">
                  <div class="title">Source</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 4a code -->
                     <pre>
                        #include <iostream>

                        #include <opencv2/opencv.hpp>
                        #include <opencv2/imgproc/imgproc.hpp>
                        #include <opencv2/highgui/highgui.hpp>
                        #include <opencv2/imgcodecs/imgcodecs.hpp>
                        
                        using namespace std;
                        using namespace cv;
                        
                        void processPieceMatch(Mat src, Mat dst, Mat temp, Mat replacementTemp, double thresh, bool isBlack);
                        
                        int main()
                        {
                              char keyPress;
                              cout << "p4a_opencv\n";
                              // Read image
                              Mat src1 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_4\\p4_board_1.jpg", IMREAD_GRAYSCALE);
                              Mat src2 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_4\\p4_board_2.jpg", IMREAD_GRAYSCALE);
                              Mat src3 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_4\\p4_board_3.jpg", IMREAD_GRAYSCALE);
                        
                              // Load the knight chess piece templates
                              Mat bpd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackPawnDark.jpg", IMREAD_GRAYSCALE);
                              Mat bpl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackPawnLight.jpg", IMREAD_GRAYSCALE);
                              Mat wpd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whitePawnDark.jpg", IMREAD_GRAYSCALE);
                              Mat wpl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whitePawnLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat bqd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackQueenDark.jpg", IMREAD_GRAYSCALE);
                              Mat bql = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackQueenLight.jpg", IMREAD_GRAYSCALE);
                              Mat wqd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteQueenDark.jpg", IMREAD_GRAYSCALE);
                              Mat wql = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteQueenLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat dst1 = src1.clone();
                              Mat dst2 = src2.clone();
                              Mat dst3 = src3.clone();
                        
                              // Detect pawn positions and flip colors
                              processPieceMatch(src1, dst1, wpd, wqd, 0.95, false);
                              processPieceMatch(src1, dst1, wpl, wql, 0.95, false);
                              processPieceMatch(src1, dst1, bpd, bqd, 0.999, true);
                              processPieceMatch(src1, dst1, bpl, bql, 0.9997, true);
                        
                              processPieceMatch(src2, dst2, wpd, wqd, 0.95, false);
                              processPieceMatch(src2, dst2, wpl, wql, 0.95, false);
                              processPieceMatch(src2, dst2, bpd, bqd, 0.999, true);
                              processPieceMatch(src2, dst2, bpl, bql, 0.9997, true);
                        
                              processPieceMatch(src3, dst3, wpd, wqd, 0.95, false);
                              processPieceMatch(src3, dst3, wpl, wql, 0.95, false);
                              processPieceMatch(src3, dst3, bpd, bqd, 0.999, true);
                              processPieceMatch(src3, dst3, bpl, bql, 0.9997, true);
                        
                              // Display results
                              imshow("Board 1 Results", dst1);
                              imshow("Board 2 Results", dst2);
                              imshow("Board 3 Results", dst3);
                        
                              while(1)
                              {
                                 keyPress = waitKey();
                                 // Press q key to close window
                                 if (keyPress == 'q')
                                 {
                                    destroyAllWindows();
                                    break;
                                 }
                              }
                              return 0;
                        }
                        
                        // Source: https://stackoverflow.com/questions/32041063/multiple-template-matching-only-detects-one-match/32095085#32095085
                        // This code is based on the solution at this link
                        void processPieceMatch(Mat src, Mat dst, Mat temp, Mat replacementTemp, double thresh, bool isBlack) {
                              // Match the A template on the grid
                              Mat1f result;
                              matchTemplate(src, temp, result, TM_CCOEFF_NORMED);
                        
                              // Replace all pixels with a value less than 0.95 with 0, so they are not processed as a match (confidence threshold)
                              threshold(result, result, thresh, 1., THRESH_BINARY);
                        
                              // Convert result to CV_8U to support finding contours
                              Mat resb;
                              result.convertTo(resb, CV_8U, 255);
                        
                              // Find the contours of the grayscale match result
                              vector<vector<Point>> contours;
                              findContours(resb, contours, RETR_LIST, CHAIN_APPROX_SIMPLE);
                        
                              // Process each matching A
                              for (uint i=0; i<contours.size(); ++i)
                              {
                                 // Mask out all other matching A's except the one that corresponds to the current contour
                                 Mat mask(result.rows, result.cols, uchar(0));
                                 drawContours(mask, contours, i, Scalar(255), FILLED);
                        
                                 // Find the maximum matching location
                                 Point max_point;
                                 double max_val;
                                 minMaxLoc(result, NULL, &max_val, NULL, &max_point, mask);
                        
                                 // Replace the pixels at this pawn with the pixels for the flipped color
                                 if (isBlack && max_point.y >= 420) {
                                    Rect roi(max_point.x, max_point.y, 60, 60);
                                    replacementTemp.copyTo(dst(roi));
                                 } else if (!isBlack and max_point.y < 60) {
                                    Rect roi(max_point.x, max_point.y, 60, 60);
                                    replacementTemp.copyTo(dst(roi));
                                 }
                              }
                        }                           
										</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
            </div>
         </div>
         <div class="sect1">
            <h2 id="_part_4b">Part 4B</h2>
            <div class="sectionbody">
               <div class="paragraph">
                  <p>Modify your program from Part 4A to work with a slightly noisy board with grain.</p>
               </div>
               <table class="tableblock frame-all grid-all" style=" width:100%; ">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <tbody>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_4/p4_board_1_grain.jpg" alt="input/Part_4/p4_board_1_grain.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_4/p4_board_2_grain.jpg" alt="input/Part_4/p4_board_2_grain.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_4/p4_board_3_grain.jpg" alt="input/Part_4/p4_board_3_grain.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 4b image 1 -->
                                 <img src="output/Part_4b/p4b_opencv_result_1.png" alt="output/Part_4b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 4b image 2 -->
                                 <img src="output/Part_4b/p4b_opencv_result_2.png" alt="output/Part_4b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 4b image 3 -->
                                 <img src="output/Part_4b/p4b_opencv_result_3.png" alt="output/Part_4b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>

                  </tr>
                  </tbody>
               </table>
               <div class="listingblock">
                  <div class="title">Source</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 4b code -->
                     <pre>
                        #include <iostream>

                        #include <opencv2/opencv.hpp>
                        #include <opencv2/imgproc/imgproc.hpp>
                        #include <opencv2/highgui/highgui.hpp>
                        #include <opencv2/imgcodecs/imgcodecs.hpp>
                        
                        using namespace std;
                        using namespace cv;
                        
                        struct piece {
                              string name;
                              Rect roi;
                              Mat temp;
                              Mat replacementTemp;
                              double value = 0;
                        };
                        
                        piece board1[8][8];
                        piece board2[8][8];
                        piece board3[8][8];
                        
                        void processPieceMatch(Mat src, Mat dst, Mat temp, Mat replacementTemp, double thresh, bool isBlack, int board);
                        
                        int main()
                        {
                              char keyPress;
                              cout << "p4a_opencv\n";
                              // Read image
                              Mat src1 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_4\\p4_board_1_grain.jpg", IMREAD_GRAYSCALE);
                              Mat src2 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_4\\p4_board_2_grain.jpg", IMREAD_GRAYSCALE);
                              Mat src3 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_4\\p4_board_3_grain.jpg", IMREAD_GRAYSCALE);
                        
                              Mat src1c = src1.clone();
                              Mat src2c = src2.clone();
                              Mat src3c = src3.clone();
                        
                              // Load the knight chess piece templates
                              Mat bpd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackPawnDark.jpg", IMREAD_GRAYSCALE);
                              Mat bpl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackPawnLight.jpg", IMREAD_GRAYSCALE);
                              Mat wpd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whitePawnDark.jpg", IMREAD_GRAYSCALE);
                              Mat wpl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whitePawnLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat bpdc = bpd.clone();
                              Mat bplc = bpl.clone();
                              Mat wpdc = wpd.clone();
                              Mat wplc = wpl.clone();
                        
                              Mat bqd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackQueenDark.jpg", IMREAD_GRAYSCALE);
                              Mat bql = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackQueenLight.jpg", IMREAD_GRAYSCALE);
                              Mat wqd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteQueenDark.jpg", IMREAD_GRAYSCALE);
                              Mat wql = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteQueenLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat dst1 = src1.clone();
                              Mat dst2 = src2.clone();
                              Mat dst3 = src3.clone();
                        
                              // Apply median blur to reduce the noise in the images
                              int b = 5;
                              medianBlur(src1c, src1c, b);
                              medianBlur(src2c, src2c, b);
                              medianBlur(src3c, src3c, b);
                              medianBlur(bpdc, bpdc, b);
                              medianBlur(bplc, bplc, b);
                              medianBlur(wpdc, wpdc, b);
                              medianBlur(wplc, wplc, b);
                        
                              b = 21;
                              medianBlur(src1, src1, b);
                              medianBlur(src2, src2, b);
                              medianBlur(src3, src3, b);
                              medianBlur(bpd, bpd, b);
                              medianBlur(bpl, bpl, b);
                              medianBlur(wpd, wpd, b);
                              medianBlur(wpl, wpl, b);
                        
                              bitwise_not(src1, src1);
                              bitwise_not(src2, src2);
                              bitwise_not(src3, src3);
                              bitwise_not(bpd, bpd);
                              bitwise_not(bpl, bpl);
                              bitwise_not(wpd, wpd);
                              bitwise_not(wpl, wpl);
                        
                              // Detect pawn positions and flip colors
                              processPieceMatch(src1, dst1, bpd, bqd, 0.955, true, 1);
                              processPieceMatch(src1, dst1, bpl, bql, 0.99, true, 1);
                        
                              // Replace top and bottom pawn pieces
                              for (int col = 0; col < 8; col++) {
                                 if (board1[7][col].name.compare("Black Pawn") == 0) {
                                    piece p = board1[7][col];
                                    p.replacementTemp.copyTo(dst1(p.roi));
                                 }
                              }
                        
                              processPieceMatch(src1c, dst1, wplc, wql, 0.9, false, 1);
                              processPieceMatch(src1c, dst1, wpdc, wqd, 0.9, false, 1);
                        
                              // Replace top and bottom pawn pieces
                              for (int col = 0; col < 8; col++) {
                                 if (board1[0][col].name == "White Pawn") {
                                    piece p = board1[0][col];
                                    p.replacementTemp.copyTo(dst1(p.roi));
                                 }
                              }
                        
                              // Print board 2
                              processPieceMatch(src2, dst2, bpd, bqd, 0.955, true, 2);
                              processPieceMatch(src2, dst2, bpl, bql, 0.99, true, 2);
                              for (int col = 0; col < 8; col++) {
                                 if (board2[7][col].name.compare("Black Pawn") == 0) {
                                    piece p = board2[7][col];
                                    p.replacementTemp.copyTo(dst2(p.roi));
                                 }
                              }
                        
                              processPieceMatch(src2c, dst2, wpdc, wqd, 0.9, false, 2);
                              processPieceMatch(src2c, dst2, wplc, wql, 0.9, false, 2);
                              for (int col = 0; col < 8; col++) {
                                 if (board2[0][col].name == "White Pawn") {
                                    piece p = board2[0][col];
                                    p.replacementTemp.copyTo(dst2(p.roi));
                                 }
                              }
                        
                              // Process board 3
                              processPieceMatch(src3, dst3, bpd, bqd, 0.955, true, 3);
                              processPieceMatch(src3, dst3, bpl, bql, 0.99, true, 3);
                              for (int col = 0; col < 8; col++) {
                                 if (board3[7][col].name.compare("Black Pawn") == 0) {
                                    piece p = board3[7][col];
                                    p.replacementTemp.copyTo(dst3(p.roi));
                                 }
                              }
                        
                              processPieceMatch(src3c, dst3, wpdc, wqd, 0.9, false, 3);
                              processPieceMatch(src3c, dst3, wplc, wql, 0.9, false, 3);
                              for (int col = 0; col < 8; col++) {
                                 if (board3[0][col].name == "White Pawn") {
                                    piece p = board3[0][col];
                                    p.replacementTemp.copyTo(dst3(p.roi));
                                 }
                              }
                        
                              // Display results
                              imshow("Board 1 Results", dst1);
                              imshow("Board 2 Results", dst2);
                              imshow("Board 3 Results", dst3);
                        
                              while(1)
                              {
                                 keyPress = waitKey();
                                 // Press q key to close window
                                 if (keyPress == 'q')
                                 {
                                    destroyAllWindows();
                                    break;
                                 }
                              }
                              return 0;
                        }
                        
                        // Source: https://stackoverflow.com/questions/32041063/multiple-template-matching-only-detects-one-match/32095085#32095085
                        // This code is based on the solution at this link
                        void processPieceMatch(Mat src, Mat dst, Mat temp, Mat replacementTemp, double thresh, bool isBlack, int board) {
                              // Match the A template on the grid
                              Mat1f result;
                              matchTemplate(src, temp, result, TM_CCOEFF_NORMED);
                        
                              // Replace all pixels with a value less than 0.95 with 0, so they are not processed as a match (confidence threshold)
                              threshold(result, result, thresh, 1., THRESH_BINARY);
                        //    result.setTo(0, result<0.8);
                        
                              imshow("Result", result);
                        
                              // Convert result to CV_8U to support finding contours
                              Mat resb;
                              result.convertTo(resb, CV_8U, 255);
                        
                              // Find the contours of the grayscale match result
                              vector<vector<Point>> contours;
                              findContours(resb, contours, RETR_LIST, CHAIN_APPROX_SIMPLE);
                        
                              // Process each matching A
                              for (uint i=0; i<contours.size(); ++i)
                              {
                                 // Mask out all other matching A's except the one that corresponds to the current contour
                                 Mat mask(result.rows, result.cols, uchar(0));
                                 drawContours(mask, contours, i, Scalar(255), FILLED);
                        
                                 // Find the maximum matching location
                                 Point max_point;
                                 double max_val;
                                 minMaxLoc(result, NULL, &max_val, NULL, &max_point, mask);
                        
                                 // Replace the pixels at this pawn with the pixels for the flipped color
                                 if (board == 1 && max_val > board1[max_point.y/60][max_point.x/60].value) {
                                    piece p;
                                    p.name = isBlack ? "Black Pawn" : "White Pawn";
                                    Rect roi(max_point.x, max_point.y, 60, 60);
                                    p.roi = roi;
                                    p.temp = temp;
                                    p.replacementTemp = replacementTemp;
                                    p.value = max_val;
                                    if (isBlack and max_point.y > 200) {
                                          board1[max_point.y/60][max_point.x/60] = p;
                                    } else if (!isBlack and max_point.y < 200) {
                                          board1[max_point.y/60][max_point.x/60] = p;
                                    }
                                 } else if (board == 2 && max_val > board2[max_point.y/60][max_point.x/60].value) {
                                    piece p;
                                    p.name = isBlack ? "Black Pawn" : "White Pawn";
                                    Rect roi(max_point.x, max_point.y, 60, 60);
                                    p.roi = roi;
                                    p.temp = temp;
                                    p.replacementTemp = replacementTemp;
                                    p.value = max_val;
                                    if (isBlack and max_point.y > 200) {
                                          board2[max_point.y/60][max_point.x/60] = p;
                                    } else if (!isBlack and max_point.y < 200) {
                                          board2[max_point.y/60][max_point.x/60] = p;
                                    }
                                 } else if (board == 3 && max_val > board3[max_point.y/60][max_point.x/60].value) {
                                    piece p;
                                    p.name = isBlack ? "Black Pawn" : "White Pawn";
                                    Rect roi(max_point.x, max_point.y, 60, 60);
                                    p.roi = roi;
                                    p.temp = temp;
                                    p.replacementTemp = replacementTemp;
                                    p.value = max_val;
                                    if (isBlack and max_point.y > 200) {
                                          board3[max_point.y/60][max_point.x/60] = p;
                                    } else if (!isBlack and max_point.y < 200) {
                                          board3[max_point.y/60][max_point.x/60] = p;
                                    }
                                 }
                              }
                        }                           
										</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
            </div>
         </div>
         <div class="sect1">
            <h2 id="_part_5a">Part 5A</h2>
            <div class="sectionbody">
               <div class="paragraph">
                  <p>Detect the position and color of all chess pieces and output the information to a text file.</p>
               </div>
               <div class="listingblock">
                  <div class="title">Text Output Example for Image 1</div>
                  <div class="content monospaced">
                     <pre>
A8: Black Rook
B8: Empty
C8: Empty
... (continue top row (8) here)

A7: Black Pawn
B7: Black Pawn
... (continue row here)

...
... (continue middle rows here)

A1: White Rook
B1: Empty
C1: Empty
D1: White King
... (continue bottom row (1) here)</pre>
                  </div>
               </div>
               <table class="tableblock frame-all grid-all" style=" width:100%; ">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <tbody>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_5/p5_board_1.jpg" alt="input/Part_5/p5_board_1.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_5/p5_board_2.jpg" alt="input/Part_5/p5_board_2.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_5/p5_board_3.jpg" alt="input/Part_5/p5_board_3.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 5a image 1 -->
                                 <img src="output/Part_5a/placeholder.jpg" alt="output/Part_5a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 5a image 2 -->
                                 <img src="output/Part_5a/placeholder.jpg" alt="output/Part_5a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 5a image 3 -->
                                 <img src="output/Part_5a/placeholder.jpg" alt="output/Part_5a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>

                  </tr>
                  <tr>
                     <td class="tableblock halign-left valign-top">
                        <div class="codetext">
                           <h3><strong>Output 1:</strong></h3>
                           <div class="listingblock">
                              <div class="content monospaced">
                     <pre>
                        A8: Black Rook
                        B8: Empty
                        C8: Empty
                        D8: Empty
                        E8: Empty
                        F8: Black Rook
                        G8: Empty
                        H8: Black Queen
                        A7: Black Pawn
                        B7: Black Pawn
                        C7: Empty
                        D7: Empty
                        E7: Black Bishop
                        F7: Empty
                        G7: Black Pawn
                        H7: Empty
                        A6: Empty
                        B6: Black King
                        C6: Empty
                        D6: Black Pawn
                        E6: Empty
                        F6: Empty
                        G6: Empty
                        H6: Black Pawn
                        A5: Empty
                        B5: Empty
                        C5: Empty
                        D5: Empty
                        E5: Black Pawn
                        F5: Empty
                        G5: Empty
                        H5: Empty
                        A4: Empty
                        B4: Empty
                        C4: White Bishop
                        D4: Empty
                        E4: Empty
                        F4: Empty
                        G4: Black Knight
                        H4: Empty
                        A3: White Pawn
                        B3: Empty
                        C3: Empty
                        D3: Empty
                        E3: Empty
                        F3: Empty
                        G3: Empty
                        H3: Empty
                        A2: Empty
                        B2: White Pawn
                        C2: White Pawn
                        D2: White Bishop
                        E2: White Knight
                        F2: White Pawn
                        G2: White Pawn
                        H2: White Pawn
                        A1: White Rook
                        B1: Empty
                        C1: Empty
                        D1: White King
                        E1: Empty
                        F1: White Rook
                        G1: White Queen
                        H1: Empty
                        </pre>
                              </div>
                           </div>
                        </div>
                     </td>
                     <td class="tableblock halign-left valign-top">
                        <div class="codetext">
                           <h3><strong>Output 2:</strong></h3>
                           <div class="listingblock">
                              <div class="content monospaced">
                     <pre>
                        A8: Empty
                        B8: Empty
                        C8: Black Bishop
                        D8: Black King
                        E8: Black Queen
                        F8: Empty
                        G8: Empty
                        H8: Empty
                        A7: Empty
                        B7: Empty
                        C7: Black Pawn
                        D7: Empty
                        E7: Black Knight
                        F7: Empty
                        G7: White Pawn
                        H7: Empty
                        A6: Empty
                        B6: Empty
                        C6: White Knight
                        D6: Black Pawn
                        E6: Empty
                        F6: Empty
                        G6: Empty
                        H6: Black Rook
                        A5: Empty
                        B5: Black Pawn
                        C5: Black Knight
                        D5: White Pawn
                        E5: Empty
                        F5: Empty
                        G5: White Knight
                        H5: Black Pawn
                        A4: Black Rook
                        B4: Black Pawn
                        C4: Empty
                        D4: Empty
                        E4: Black Pawn
                        F4: Empty
                        G4: Empty
                        H4: White Rook
                        A3: White Pawn
                        B3: Empty
                        C3: Empty
                        D3: Empty
                        E3: White Pawn
                        F3: Empty
                        G3: Empty
                        H3: Empty
                        A2: Empty
                        B2: Empty
                        C2: White Pawn
                        D2: Empty
                        E2: Empty
                        F2: Empty
                        G2: Empty
                        H2: Empty
                        A1: White Rook
                        B1: Empty
                        C1: White Bishop
                        D1: White King
                        E1: White Queen
                        F1: White Bishop
                        G1: Empty
                        H1: Empty
                        </pre>
                              </div>
                           </div>
                        </div>
                     </td>
                     <td class="tableblock halign-left valign-top">
                        <div class="codetext">
                           <h3><strong>Output 3:</strong></h3>
                           <div class="listingblock">
                              <div class="content monospaced">
                     <pre>
                        A8: Empty
                        B8: Black King
                        C8: Empty
                        D8: Empty
                        E8: Empty
                        F8: Empty
                        G8: Black Queen
                        H8: Empty
                        A7: Empty
                        B7: Empty
                        C7: Black Pawn
                        D7: White Pawn
                        E7: Empty
                        F7: Empty
                        G7: Empty
                        H7: Empty
                        A6: Black Bishop
                        B6: Black Knight
                        C6: White Pawn
                        D6: Empty
                        E6: Black Pawn
                        F6: Empty
                        G6: Empty
                        H6: Black Bishop
                        A5: Black Rook
                        B5: White King
                        C5: White Bishop
                        D5: Empty
                        E5: Black Knight
                        F5: Black Rook
                        G5: Black Pawn
                        H5: White Pawn
                        A4: Empty
                        B4: Empty
                        C4: Empty
                        D4: Empty
                        E4: Empty
                        F4: Empty
                        G4: White Pawn
                        H4: Empty
                        A3: Empty
                        B3: White Pawn
                        C3: Empty
                        D3: Empty
                        E3: White Pawn
                        F3: Empty
                        G3: Empty
                        H3: White Rook
                        A2: White Queen
                        B2: Empty
                        C2: White Pawn
                        D2: White Bishop
                        E2: White Knight
                        F2: White Pawn
                        G2: Empty
                        H2: Empty
                        A1: Empty
                        B1: Empty
                        C1: White Rook
                        D1: Empty
                        E1: Empty
                        F1: Empty
                        G1: Empty
                        H1: Empty
                        </pre>
                              </div>
                           </div>
                        </div>
                     </td>
                  </tr>
                  </tbody>
               </table>
               <div class="listingblock">
                  <div class="title">Source</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 5a code -->
                     <pre>
                        #include <iostream>
                        #include <fstream>
                        
                        #include <opencv2/opencv.hpp>
                        #include <opencv2/imgproc/imgproc.hpp>
                        #include <opencv2/highgui/highgui.hpp>
                        #include <opencv2/imgcodecs/imgcodecs.hpp>
                        
                        using namespace std;
                        using namespace cv;
                        
                        struct piece {
                              string name = "Empty";
                              int value = 0;
                        };
                        
                        piece board1[8][8];
                        piece board2[8][8];
                        piece board3[8][8];
                        
                        void processPieceMatch(Mat src, Mat temp, string name, int board);
                        
                        int main()
                        {
                              char keyPress;
                              cout << "p1_opencv\n";
                              // Read image
                              Mat src1 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_5\\p5_board_1.jpg", IMREAD_GRAYSCALE);
                              Mat src2 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_5\\p5_board_2.jpg", IMREAD_GRAYSCALE);
                              Mat src3 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_5\\p5_board_3.jpg", IMREAD_GRAYSCALE);
                        
                              // Load the knight chess piece templates
                              Mat brd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackRookDark.jpg", IMREAD_GRAYSCALE);
                              Mat brl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackRookLight.jpg", IMREAD_GRAYSCALE);
                              Mat wrd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteRookDark.jpg", IMREAD_GRAYSCALE);
                              Mat wrl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteRookLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat bbd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackBishopDark.jpg", IMREAD_GRAYSCALE);
                              Mat bbl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackBishopLight.jpg", IMREAD_GRAYSCALE);
                              Mat wbd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteBishopDark.jpg", IMREAD_GRAYSCALE);
                              Mat wbl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteBishopLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat bqd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackQueenDark.jpg", IMREAD_GRAYSCALE);
                              Mat bql = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackQueenLight.jpg", IMREAD_GRAYSCALE);
                              Mat wqd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteQueenDark.jpg", IMREAD_GRAYSCALE);
                              Mat wql = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteQueenLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat bkd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackKnightDark.jpg", IMREAD_GRAYSCALE);
                              Mat bkl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackKnightLight.jpg", IMREAD_GRAYSCALE);
                              Mat wkd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteKnightDark.jpg", IMREAD_GRAYSCALE);
                              Mat wkl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteKnightLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat bgd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackKingDark.jpg", IMREAD_GRAYSCALE);
                              Mat bgl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackKingLight.jpg", IMREAD_GRAYSCALE);
                              Mat wgd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteKingDark.jpg", IMREAD_GRAYSCALE);
                              Mat wgl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteKingLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat bpd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackPawnDark.jpg", IMREAD_GRAYSCALE);
                              Mat bpl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackPawnLight.jpg", IMREAD_GRAYSCALE);
                              Mat wpd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whitePawnDark.jpg", IMREAD_GRAYSCALE);
                              Mat wpl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whitePawnLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat pieceTemplates[] = {brd,brl,wrd,wrl,bbd,bbl,wbd,wbl,bqd,bql,wqd,wql,bkd,bkl,wkd,wkl,bgd,bgl,wgd,wgl,bpd,bpl,wpd,wpl};
                              string pieceNames[] = {"Black Rook", "Black Rook", "White Rook", "White Rook",
                                                "Black Bishop", "Black Bishop", "White Bishop", "White Bishop",
                                                "Black Queen", "Black Queen", "White Queen", "White Queen",
                                                "Black Knight", "Black Knight", "White Knight", "White Knight",
                                                "Black King", "Black King", "White King", "White King",
                                                "Black Pawn", "Black Pawn", "White Pawn", "White Pawn"};
                              int numPieceTemplates = 24;
                        
                              for (int i = 0; i < numPieceTemplates; i++) {
                                 processPieceMatch(src1, pieceTemplates[i], pieceNames[i], 1);
                                 processPieceMatch(src2, pieceTemplates[i], pieceNames[i], 2);
                                 processPieceMatch(src3, pieceTemplates[i], pieceNames[i], 3);
                              }
                        
                              // Write output to file
                              ofstream Board1File("p5a_result_1.txt");
                              ofstream Board2File("p5a_result_2.txt");
                              ofstream Board3File("p5a_result_3.txt");
                              char letters[] = {'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'};
                              for (int row = 0; row < 8; row++) {
                                 for (int col = 0; col < 8; col++) {
                                    // Print results to files
                                    std::string s(1, letters[col]);
                                    string position = s + std::to_string(8-row);
                                    Board1File << position.c_str() << ": " << board1[row][col].name.c_str() << "\n";
                                    Board2File << position << ": " << board2[row][col].name << "\n";
                                    Board3File << position << ": " << board3[row][col].name << "\n";
                                 }
                              }
                        
                              Board1File.close();
                              Board2File.close();
                              Board3File.close();
                              cout << "Successfully completed!\n";
                        }
                        
                        // Source: https://stackoverflow.com/questions/32041063/multiple-template-matching-only-detects-one-match/32095085#32095085
                        // This code is based on the solution at this link
                        void processPieceMatch(Mat src, Mat temp, string name, int board) {
                              // Match the A template on the grid
                              Mat1f result;
                              matchTemplate(src, temp, result, TM_CCOEFF_NORMED);
                        
                              // Replace all pixels with a value less than 0.95 with 0, so they are not processed as a match (confidence threshold)
                              double thresh = 0.99;
                              threshold(result, result, thresh, 1., THRESH_BINARY);
                        
                              // Convert result to CV_8U to support finding contours
                              Mat resb;
                              result.convertTo(resb, CV_8U, 255);
                        
                              // Find the contours of the grayscale match result
                              vector<vector<Point>> contours;
                              findContours(resb, contours, RETR_LIST, CHAIN_APPROX_SIMPLE);
                        
                              // Process each matching A
                              for (uint i=0; i<contours.size(); ++i)
                              {
                                 // Mask out all other matching A's except the one that corresponds to the current contour
                                 Mat mask(result.rows, result.cols, uchar(0));
                                 drawContours(mask, contours, i, Scalar(255), FILLED);
                        
                                 // Find the maximum matching location
                                 Point max_point;
                                 double max_val;
                                 minMaxLoc(result, NULL, &max_val, NULL, &max_point, mask);
                        
                                 // See if the current piece has a larger coorelation value than current max point
                                 if (board == 1) {
                                    if (max_val > board1[max_point.y/60][max_point.x/60].value) {
                                          piece cur;
                                          cur.name = name;
                                          cur.value = max_val;
                                          board1[max_point.y/60][max_point.x/60] = cur;
                                    }
                                 } else if (board == 2) {
                                    if (max_val > board2[max_point.y/60][max_point.x/60].value) {
                                          piece cur;
                                          cur.name = name;
                                          cur.value = max_val;
                                          board2[max_point.y/60][max_point.x/60] = cur;
                                    }
                                 } else {
                                    if (max_val > board3[max_point.y/60][max_point.x/60].value) {
                                          piece cur;
                                          cur.name = name;
                                          cur.value = max_val;
                                          board3[max_point.y/60][max_point.x/60] = cur;
                                    }
                                 }
                              }
                        }                           
										</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
            </div>
         </div>
         <div class="sect1">
            <h2 id="_part_5b">Part 5B</h2>
            <div class="sectionbody">
               <div class="paragraph">
                  <p>Modify your program from Part 4B to work with a slightly noisy board with grain.</p>
               </div>
               <table class="tableblock frame-all grid-all" style=" width:100%; ">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <tbody>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_5/p5_board_1b_grain.jpg" alt="input/Part_5/p5_board_1b_grain.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_5/p5_board_2b_grain.jpg" alt="input/Part_5/p5_board_2b_grain.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_5/p5_board_3b_grain.jpg" alt="input/Part_5/p5_board_3b_grain.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 5b image 1 -->
                                 <img src="output/Part_5b/placeholder.jpg" alt="output/Part_5b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 5b image 2 -->
                                 <img src="output/Part_5b/placeholder.jpg" alt="output/Part_5b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 5b image 3 -->
                                 <img src="output/Part_5b/placeholder.jpg" alt="output/Part_5b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>

                  </tr>
                  <tr>
                     <td class="tableblock halign-left valign-top">
                        <div class="codetext">
                           <h3><strong>Output 1:</strong></h3>
                           <div class="listingblock">
                              <div class="content monospaced">
                     <pre>
                        A8: Black Rook
                        B8: Empty
                        C8: Black Bishop
                        D8: Black King
                        E8: Black Queen
                        F8: Black Bishop
                        G8: Empty
                        H8: Empty
                        A7: Black Pawn
                        B7: Empty
                        C7: Black Pawn
                        D7: Black Knight
                        E7: Empty
                        F7: Empty
                        G7: Empty
                        H7: Empty
                        A6: Empty
                        B6: Empty
                        C6: Empty
                        D6: Empty
                        E6: Black Pawn
                        F6: Black Knight
                        G6: White Knight
                        H6: Black Pawn
                        A5: Empty
                        B5: White Pawn
                        C5: Empty
                        D5: Black Rook
                        E5: White Pawn
                        F5: Black Pawn
                        G5: Empty
                        H5: White Pawn
                        A4: Empty
                        B4: Empty
                        C4: Empty
                        D4: White Pawn
                        E4: Empty
                        F4: White Rook
                        G4: Empty
                        H4: Empty
                        A3: White Bishop
                        B3: White Pawn
                        C3: White Knight
                        D3: Empty
                        E3: Empty
                        F3: Empty
                        G3: White Pawn
                        H3: Empty
                        A2: Empty
                        B2: Empty
                        C2: Empty
                        D2: White Pawn
                        E2: Empty
                        F2: Empty
                        G2: Empty
                        H2: Empty
                        A1: White Rook
                        B1: Empty
                        C1: Empty
                        D1: White King
                        E1: White Queen
                        F1: White Bishop
                        G1: Empty
                        H1: Empty
                        </pre>
                              </div>
                           </div>
                        </div>
                     </td>
                     <td class="tableblock halign-left valign-top">
                        <div class="codetext">
                           <h3><strong>Output 2:</strong></h3>
                           <div class="listingblock">
                              <div class="content monospaced">
                     <pre>
                        A8: Empty
                        B8: Empty
                        C8: Black Queen
                        D8: Black Rook
                        E8: Empty
                        F8: Empty
                        G8: Empty
                        H8: Black Rook
                        A7: Empty
                        B7: Black Bishop
                        C7: Empty
                        D7: Black Knight
                        E7: Black King
                        F7: Black Pawn
                        G7: Empty
                        H7: Black Pawn
                        A6: Black Pawn
                        B6: Empty
                        C6: Black Pawn
                        D6: Black Pawn
                        E6: Empty
                        F6: Black Knight
                        G6: Black Pawn
                        H6: White King
                        A5: Empty
                        B5: Black Pawn
                        C5: Empty
                        D5: Empty
                        E5: Empty
                        F5: Empty
                        G5: Empty
                        H5: Empty
                        A4: Empty
                        B4: Empty
                        C4: Empty
                        D4: White Knight
                        E4: White Pawn
                        F4: Empty
                        G4: Empty
                        H4: Empty
                        A3: White Pawn
                        B3: Empty
                        C3: White Knight
                        D3: Empty
                        E3: Empty
                        F3: White Pawn
                        G3: Empty
                        H3: Empty
                        A2: Empty
                        B2: White Pawn
                        C2: White Pawn
                        D2: White Pawn
                        E2: Empty
                        F2: Empty
                        G2: White Pawn
                        H2: White Pawn
                        A1: Empty
                        B1: White Queen
                        C1: Empty
                        D1: Empty
                        E1: Empty
                        F1: White Bishop
                        G1: White Rook
                        H1: White Rook
                        </pre>
                              </div>
                           </div>
                        </div>
                     </td>
                     <td class="tableblock halign-left valign-top">
                        <div class="codetext">
                           <h3><strong>Output 3:</strong></h3>
                           <div class="listingblock">
                              <div class="content monospaced">
                     <pre>
                        A8: Black Rook
                        B8: Empty
                        C8: Empty
                        D8: Black King
                        E8: Black Queen
                        F8: Black Bishop
                        G8: Empty
                        H8: Empty
                        A7: Empty
                        B7: Empty
                        C7: Empty
                        D7: Black Bishop
                        E7: Empty
                        F7: Empty
                        G7: Empty
                        H7: Empty
                        A6: Black Pawn
                        B6: Empty
                        C6: Black Pawn
                        D6: Empty
                        E6: Black Pawn
                        F6: Empty
                        G6: White Knight
                        H6: Empty
                        A5: White Pawn
                        B5: Black Pawn
                        C5: Empty
                        D5: Black Pawn
                        E5: Empty
                        F5: Black Pawn
                        G5: Empty
                        H5: Black Rook
                        A4: Empty
                        B4: White Pawn
                        C4: White Knight
                        D4: White Pawn
                        E4: Black Knight
                        F4: Empty
                        G4: Black Pawn
                        H4: Empty
                        A3: White Rook
                        B3: Empty
                        C3: White Pawn
                        D3: Empty
                        E3: White Pawn
                        F3: Empty
                        G3: White Pawn
                        H3: Black Pawn
                        A2: Empty
                        B2: Empty
                        C2: Empty
                        D2: Empty
                        E2: Empty
                        F2: White Pawn
                        G2: Empty
                        H2: White Pawn
                        A1: Empty
                        B1: Empty
                        C1: White Bishop
                        D1: White King
                        E1: White Queen
                        F1: White Bishop
                        G1: Empty
                        H1: White Rook
                        </pre>
                              </div>
                           </div>
                        </div>
                     </td>
                  </tr>
                  </tbody>
               </table>
               <div class="listingblock">
                  <div class="title">Source</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 5b code -->
                     <pre>
                        #include <iostream>
                        #include <fstream>
                        
                        #include <opencv2/opencv.hpp>
                        #include <opencv2/imgproc/imgproc.hpp>
                        #include <opencv2/highgui/highgui.hpp>
                        #include <opencv2/imgcodecs/imgcodecs.hpp>
                        
                        using namespace std;
                        using namespace cv;
                        
                        struct piece {
                              string name = "Empty";
                              int value = 0;
                        };
                        
                        piece board1[8][8];
                        piece board2[8][8];
                        piece board3[8][8];
                        
                        void processPieceMatch(Mat src, Mat temp, string name, int board, double thresh);
                        
                        int main()
                        {
                              char keyPress;
                              cout << "p1_opencv\n";
                              // Read image
                              Mat src1 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_5\\p5_board_1b_grain.jpg", IMREAD_GRAYSCALE);
                              Mat src2 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_5\\p5_board_2b_grain.jpg", IMREAD_GRAYSCALE);
                              Mat src3 = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Part_5\\p5_board_3b_grain.jpg", IMREAD_GRAYSCALE);
                        
                              // Load the chess piece templates
                              Mat brd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackRookDark.jpg", IMREAD_GRAYSCALE);
                              Mat brl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackRookLight.jpg", IMREAD_GRAYSCALE);
                              Mat wrd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteRookDark.jpg", IMREAD_GRAYSCALE);
                              Mat wrl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteRookLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat bbd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackBishopDark.jpg", IMREAD_GRAYSCALE);
                              Mat bbl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackBishopLight.jpg", IMREAD_GRAYSCALE);
                              Mat wbd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteBishopDark.jpg", IMREAD_GRAYSCALE);
                              Mat wbl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteBishopLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat bqd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackQueenDark.jpg", IMREAD_GRAYSCALE);
                              Mat bql = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackQueenLight.jpg", IMREAD_GRAYSCALE);
                              Mat wqd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteQueenDark.jpg", IMREAD_GRAYSCALE);
                              Mat wql = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteQueenLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat bkd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackKnightDark.jpg", IMREAD_GRAYSCALE);
                              Mat bkl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackKnightLight.jpg", IMREAD_GRAYSCALE);
                              Mat wkd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteKnightDark.jpg", IMREAD_GRAYSCALE);
                              Mat wkl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteKnightLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat bgd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackKingDark.jpg", IMREAD_GRAYSCALE);
                              Mat bgl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackKingLight.jpg", IMREAD_GRAYSCALE);
                              Mat wgd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteKingDark.jpg", IMREAD_GRAYSCALE);
                              Mat wgl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whiteKingLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat bpd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackPawnDark.jpg", IMREAD_GRAYSCALE);
                              Mat bpl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\blackPawnLight.jpg", IMREAD_GRAYSCALE);
                              Mat wpd = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whitePawnDark.jpg", IMREAD_GRAYSCALE);
                              Mat wpl = imread("C:\\Users\\mmort\\GIT\\CprE575\\Homework\\Homework2\\HW2_2020\\HW2\\input\\Chess_Piece_Templates\\whitePawnLight.jpg", IMREAD_GRAYSCALE);
                        
                              Mat pieceTemplates[] = {brd,brl,wrd,wrl,bbd,bbl,wbd,wbl,bqd,bql,wqd,wql,bkd,bkl,wkd,wkl,bgd,bgl,wgd,wgl,bpd,bpl,wpd,wpl};
                              string pieceNames[] = {"Black Rook", "Black Rook", "White Rook", "White Rook",
                                                "Black Bishop", "Black Bishop", "White Bishop", "White Bishop",
                                                "Black Queen", "Black Queen", "White Queen", "White Queen",
                                                "Black Knight", "Black Knight", "White Knight", "White Knight",
                                                "Black King", "Black King", "White King", "White King",
                                                "Black Pawn", "Black Pawn", "White Pawn", "White Pawn"};
                              int numPieceTemplates = 24;
                        
                              // Apply median blur to remove noise
                              int b = 5;
                              medianBlur(src1, src1, b);
                              medianBlur(src2, src2, b);
                              medianBlur(src3, src3, b);
                              // Identify which piece is in what position on the board
                              double thresh;
                              for (int i = 0; i < numPieceTemplates; i++) {
                                 thresh = i%4 < 2 ? 0.99 : 0.94;
                                 medianBlur(pieceTemplates[i], pieceTemplates[i], b);
                                 processPieceMatch(src1, pieceTemplates[i], pieceNames[i], 1, thresh);
                                 processPieceMatch(src2, pieceTemplates[i], pieceNames[i], 2, thresh);
                                 processPieceMatch(src3, pieceTemplates[i], pieceNames[i], 3, thresh);
                              }
                        
                              // Write board location output to file
                              ofstream Board1File("p5a_result_1_grain.txt");
                              ofstream Board2File("p5a_result_2_grain.txt");
                              ofstream Board3File("p5a_result_3_grain.txt");
                              char letters[] = {'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'};
                              for (int row = 0; row < 8; row++) {
                                 for (int col = 0; col < 8; col++) {
                                    // Print results to files
                                    std::string s(1, letters[col]);
                                    string position = s + std::to_string(8-row);
                                    Board1File << position << ": " << board1[row][col].name << "\n";
                                    Board2File << position << ": " << board2[row][col].name << "\n";
                                    Board3File << position << ": " << board3[row][col].name << "\n";
                                 }
                              }
                        
                              Board1File.close();
                              Board2File.close();
                              Board3File.close();
                              cout << "Successfully completed!\n";
                        
                              while(1)
                              {
                                 keyPress = waitKey();
                                 // Press q key to close window
                                 if (keyPress == 'q')
                                 {
                                    destroyAllWindows();
                                    break;
                                 }
                              }
                              return 0;
                        }
                        
                        // Source: https://stackoverflow.com/questions/32041063/multiple-template-matching-only-detects-one-match/32095085#32095085
                        // This code is based on the solution at this link
                        void processPieceMatch(Mat src, Mat temp, string name, int board, double thresh) {
                              // Match the A template on the grid
                              Mat1f result;
                              matchTemplate(src, temp, result, TM_CCOEFF_NORMED);
                        
                              // Replace all pixels with a value less than 0.95 with 0, so they are not processed as a match (confidence threshold)
                              threshold(result, result, thresh, 1., THRESH_BINARY);
                        
                              // Convert result to CV_8U to support finding contours
                              Mat resb;
                              result.convertTo(resb, CV_8U, 255);
                        
                              // Find the contours of the grayscale match result
                              vector<vector<Point>> contours;
                              findContours(resb, contours, RETR_LIST, CHAIN_APPROX_SIMPLE);
                        
                              // Process each matching A
                              for (uint i=0; i<contours.size(); ++i)
                              {
                                 // Mask out all other matching A's except the one that corresponds to the current contour
                                 Mat mask(result.rows, result.cols, uchar(0));
                                 drawContours(mask, contours, i, Scalar(255), FILLED);
                        
                                 // Find the maximum matching location
                                 Point max_point;
                                 double max_val;
                                 minMaxLoc(result, NULL, &max_val, NULL, &max_point, mask);
                        
                                 // See if the current piece has a larger coorelation value than current max point
                                 if (board == 1) {
                                    if (max_val > board1[max_point.y/60][max_point.x/60].value) {
                                          piece cur;
                                          cur.name = name;
                                          cur.value = max_val;
                                          board1[max_point.y/60][max_point.x/60] = cur;
                                    }
                                 } else if (board == 2) {
                                    if (max_val > board2[max_point.y/60][max_point.x/60].value) {
                                          piece cur;
                                          cur.name = name;
                                          cur.value = max_val;
                                          board2[max_point.y/60][max_point.x/60] = cur;
                                    }
                                 } else {
                                    if (max_val > board3[max_point.y/60][max_point.x/60].value) {
                                          piece cur;
                                          cur.name = name;
                                          cur.value = max_val;
                                          board3[max_point.y/60][max_point.x/60] = cur;
                                    }
                                 }
                              }
                        }                           
										</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
            </div>
         </div>
         <div class="sect1">
            <h2 id="_part_5c">Part 5C (EXTRA CREDIT)</h2>
            <div class="sectionbody">
               <div class="paragraph">
                  <p>Detect the position and color of all chess pieces again, but with real images of the screen. (FOR EXTRA CREDIT)</p>
               </div>
               <table class="tableblock frame-all grid-all" style=" width:100%; ">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <tbody>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_5/p5_board_1_screen.jpg" alt="input/Part_5/p5_board_1_screen.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_5/p5_board_2_screen.jpg" alt="input/Part_5/p5_board_2_screen.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_5/p5_board_3_screen.jpg" alt="input/Part_5/p5_board_3_screen.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 5c image 1 -->
                                 <img src="output/Part_5c/placeholder.jpg" alt="output/Part_5c/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 5c image 2 -->
                                 <img src="output/Part_5c/placeholder.jpg" alt="output/Part_5c/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 5c image 3 -->
                                 <img src="output/Part_5c/placeholder.jpg" alt="output/Part_5c/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>

                  </tr>
                  <tr>
                     <td class="tableblock halign-left valign-top">
                        <div class="codetext">
                           <h3><strong>Output 1:</strong></h3>
                           <div class="listingblock">
                              <div class="content monospaced">
                     <pre>
Enter the output of your program here.</pre>
                              </div>
                           </div>
                        </div>
                     </td>
                     <td class="tableblock halign-left valign-top">
                        <div class="codetext">
                           <h3><strong>Output 2:</strong></h3>
                           <div class="listingblock">
                              <div class="content monospaced">
                     <pre>
Enter the output of your program here.</pre>
                              </div>
                           </div>
                        </div>
                     </td>
                     <td class="tableblock halign-left valign-top">
                        <div class="codetext">
                           <h3><strong>Output 3:</strong></h3>
                           <div class="listingblock">
                              <div class="content monospaced">
                     <pre>
Enter the output of your program here.</pre>
                              </div>
                           </div>
                        </div>
                     </td>
                  </tr>
                  </tbody>
               </table>
               <div class="listingblock">
                  <div class="title">Source</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 5c code -->
                     <pre>
// Insert your code here
										</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
            </div>
         </div>
         <div class="sect1">
            <h2 id="_part_6a">Part 6A (EXTRA CREDIT)</h2>
            <div class="sectionbody">
               <div class="paragraph">
                  <p>Swap all queens for pawns and pawns for queens. (FOR EXTRA CREDIT)</p>
               </div>
               <table class="tableblock frame-all grid-all" style=" width:100%; ">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <tbody>
                     <tr>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                              <img src="input/Part_6/p6_board_1.jpg" alt="input/Part_6/p6_board_1.jpg" width="100%">
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                              <img src="input/Part_6/p6_board_2.jpg" alt="input/Part_6/p6_board_2.jpg" width="100%">
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock"><span class="image">
                              <img src="input/Part_6/p6_board_3.jpg" alt="input/Part_6/p6_board_3.jpg" width="100%">
                              </span>
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 6a image 1 -->
                                 <img src="output/Part_6a/placeholder.jpg" alt="output/Part_6a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 6a image 2 -->
                                 <img src="output/Part_6a/placeholder.jpg" alt="output/Part_6a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                        <td class="tableblock halign-left valign-top" >
                           <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 6a image 3 -->
                                 <img src="output/Part_6a/placeholder.jpg" alt="output/Part_6a/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                           </p>
                        </td>
                     </tr>
                  </tbody>
               </table>
               <div class="listingblock">
                  <div class="title">Source</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 6a code -->
                     <pre>// Insert your code here
										</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
            </div>
         </div>
         <div class="sect1">
            <h2 id="_part_6b">Part 6B (EXTRA CREDIT)</h2>
            <div class="sectionbody">
               <div class="paragraph">
                  <p>Modify your code to work with grain added to the images. (FOR EXTRA CREDIT)</p>
               </div>
               <table class="tableblock frame-all grid-all" style=" width:100%; ">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <tbody>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_6/p6_board_1_grain.jpg" alt="input/Part_6/p6_board_1_grain.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_6/p6_board_2_grain.jpg" alt="input/Part_6/p6_board_2_grain.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_6/p6_board_3_grain.jpg" alt="input/Part_6/p6_board_3_grain.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 6b image 1 -->
                                 <img src="output/Part_6b/placeholder.jpg" alt="output/Part_6b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 6b image 2 -->
                                 <img src="output/Part_6b/placeholder.jpg" alt="output/Part_6b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 6b image 3 -->
                                 <img src="output/Part_6b/placeholder.jpg" alt="output/Part_6b/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                  </tr>
                  </tbody>
               </table>
               <div class="listingblock">
                  <div class="title">Source</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 4a code -->
                     <pre>// Insert your code here
										</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
            </div>
         </div>
         <div class="sect1">
            <h2 id="_part_6c">Part 6C (EXTRA CREDIT)</h2>
            <div class="sectionbody">
               <div class="paragraph">
                  <p>Repeat 6A again, but with real images of the screen. (FOR EXTRA CREDIT)</p>
               </div>
               <table class="tableblock frame-all grid-all" style=" width:100%; ">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <col style="width:33%;">
                  <tbody>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_6/p6_board_1_screen.jpg" alt="input/Part_6/p6_board_1_screen.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_6/p6_board_2_screen.jpg" alt="input/Part_6/p6_board_2_screen.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock"><span class="image">
                              <img src="input/Part_6/p6_board_3_screen.jpg" alt="input/Part_6/p6_board_3_screen.jpg" width="100%">
                              </span>
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 6c image 1 -->
                                 <img src="output/Part_6c/placeholder.jpg" alt="output/Part_6c/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 6c image 2 -->
                                 <img src="output/Part_6c/placeholder.jpg" alt="output/Part_6c/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                     <td class="tableblock halign-left valign-top" >
                        <p class="tableblock">
                              <span class="image">
                                 <!-- MAKE CHANGES HERE: Part 6c image 3 -->
                                 <img src="output/Part_6c/placeholder.jpg" alt="output/Part_6c/placeholder.jpg" width="100%">
                                 <!-- END CHANGES -->
                              </span>
                        </p>
                     </td>
                  </tr>
                  </tbody>
               </table>
               <div class="listingblock">
                  <div class="title">Source</div>
                  <div class="content monospaced">
                     <!-- MAKE CHANGES HERE: Part 6c code -->
                     <pre>// Insert your code here
										</pre>
                     <!-- END CHANGES -->
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div id="footer">
         <div id="footer-text">
            Last updated 2020-01-23
         </div>
      </div>
   </body>
</html>
